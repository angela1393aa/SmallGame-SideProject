<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åˆ†æ‰¹è²·é€²è©¦ç®—å™¨</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        padding: 30px;
        text-align: center;
      }
      .container {
        max-width: 700px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
      }
      input {
        padding: 10px;
        margin: 10px;
        width: 80%;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 6px;
        border: none;
        background: #007bff;
        color: #fff;
        cursor: pointer;
        transition: background 0.3s;
      }
      button:hover {
        background: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      table,
      th,
      td {
        border: 1px solid #ddd;
      }
      th,
      td {
        padding: 10px;
        text-align: center;
      }
      th {
        background: #f0f0f0;
      }
      .result {
        margin-top: 15px;
        font-size: 18px;
        color: #333;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>åˆ†æ‰¹è²·é€²è©¦ç®—å™¨</h1>
      <input type="number" id="basePrice" placeholder="è¼¸å…¥åŸºæº–åƒ¹æ ¼" />
      <input type="number" id="totalMoney" placeholder="è¼¸å…¥ç¸½è³‡é‡‘" />
      <br />
      <button onclick="calculate()">è¨ˆç®—</button>

      <div id="output"></div>
    </div>

    <script>
      function calculate() {
        const basePrice = parseFloat(
          document.getElementById("basePrice").value
        );
        const totalMoney = parseFloat(
          document.getElementById("totalMoney").value
        );

        if (!basePrice || !totalMoney) {
          alert("è«‹è¼¸å…¥åŸºæº–åƒ¹æ ¼èˆ‡ç¸½è³‡é‡‘ï¼");
          return;
        }

        // ç­–ç•¥
        const strategy = [
          { rate: 0.95, weight: 1 },
          { rate: 0.9, weight: 2 },
          { rate: 0.85, weight: 4 },
        ];

        const stopLossRate = 0.8;

        const totalWeight = strategy.reduce((sum, s) => sum + s.weight, 0);

        let rows = "";
        let totalCost = 0;
        let totalQty = 0;

        strategy.forEach((step) => {
          const price = basePrice * step.rate; // åƒ¹æ ¼
          const allocatedMoney = totalMoney * (step.weight / totalWeight); // åˆ†é…è³‡é‡‘
          const qty = (allocatedMoney / price).toFixed(2); // å¼µæ•¸
          const cost = qty * price; //é‡‘é¡
          totalCost += cost; //ç¸½é‡‘é¡
          totalQty += Number(qty); //ç¸½å¼µæ•¸

          rows += `
          <tr>
            <td>${step.rate * 100}%</td>
            <td>${price}</td>
            <td>${qty}</td>
            <td>${cost}</td>
          </tr>
        `;
        });

        // å¹³å‡åƒ¹
        const avgPrice = totalCost / totalQty;

        // åœæåƒ¹
        const stopLossPrice = basePrice * stopLossRate; //åœæåƒ¹(80%)

        // æœ€å¤§è™§æ
        const maxLoss = (avgPrice - stopLossPrice) * totalQty; //åœæåƒ¹å·®*ç¸½å¼µæ•¸

        // åœåˆ©åƒ¹ï¼ˆRR = 1:3ï¼‰
        const takeProfitPrice =
          parseFloat(avgPrice) + (avgPrice - stopLossPrice) * 3;

        document.getElementById("output").innerHTML = `
        <table>
          <tr>
            <th>è²·é€²æ¯”ä¾‹</th>
            <th>åƒ¹æ ¼</th>
            <th>å¼µæ•¸</th>
            <th>é‡‘é¡</th>
          </tr>
          ${rows}
        </table>
        <div class="result">
          ğŸ“Œ ç¸½å¼µæ•¸ï¼š${totalQty} <br>
          ğŸ’° ç¸½èŠ±è²»ï¼š${totalCost} <br>
          âš–ï¸ å¹³å‡æˆæœ¬åƒ¹ï¼š${avgPrice.toFixed(2)} <br>
          ğŸšª åœæåƒ¹ (80%)ï¼š${stopLossPrice} <br>
          âŒ æœ€å¤§å¯æ¥å—è™§æç¸½é‡‘é¡ï¼š${maxLoss.toFixed(2)} <br>
          âœ… åœåˆ©å‡ºå ´åƒ¹ (1:3 RR)ï¼š${takeProfitPrice.toFixed(2)}
        </div>
      `;
      }
    </script>
  </body>
</html>
